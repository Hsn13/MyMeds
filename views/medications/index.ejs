<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medications â€” MyMeds</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <%- include('../navbar') %>

  <main class="main-content">
    <div class="page-header">
      <h1>ðŸ’Š My Medications</h1>
      <a href="/medications/new" class="btn btn-primary">+ Add Medication</a>
    </div>

    <!-- Toggle: Show / Hide inactive medications -->
    <div class="filter-bar">
      <% if (showInactive) { %>
        <a href="/medications" class="btn btn-sm btn-secondary">Hide Inactive</a>
        <span class="filter-note">Showing all medications including inactive</span>
      <% } else { %>
        <a href="/medications?showInactive=true" class="btn btn-sm btn-secondary">Show Inactive</a>
        <span class="filter-note">Showing active medications only</span>
      <% } %>
    </div>

    <% if (medications.length === 0) { %>
      <div class="empty-state">
        <p>You don't have any medications yet.</p>
        <a href="/medications/new" class="btn btn-primary">Add Your First Medication</a>
      </div>
    <% } else { %>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Dosage</th>
              <th>Frequency</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% medications.forEach(med => { %>
              <tr class="<%= med.isActive ? '' : 'row-inactive' %>">
                <td><%= med.name %></td>
                <td><%= med.dosage %></td>
                <td><%= med.frequency %></td>
                <td><%= med.startDate.toLocaleDateString('en-US') %></td>
                <td><%= med.endDate ? med.endDate.toLocaleDateString('en-US') : 'Ongoing' %></td>
                <td>
                  <% if (med.isActive) { %>
                    <span class="badge badge-active">Active</span>
                  <% } else { %>
                    <span class="badge badge-inactive">Inactive</span>
                  <% } %>
                </td>
                <td class="actions">
                  <a href="/medications/<%= med._id %>" class="btn btn-sm btn-secondary">View</a>
                  <a href="/medications/<%= med._id %>/edit" class="btn btn-sm btn-secondary">Edit</a>
                  <% if (med.isActive) { %>
                    <!-- Soft delete: sets isActive to false -->
                    <form action="/medications/<%= med._id %>?_method=DELETE" method="POST" style="display:inline;">
                      <button type="submit" class="btn btn-sm btn-danger"
                        onclick="return confirm('Deactivate this medication? It will be hidden but not permanently deleted.')">
                        Deactivate
                      </button>
                    </form>
                  <% } else { %>
                    <!-- Reactivate: use edit to set isActive back to true -->
                    <a href="/medications/<%= med._id %>/edit" class="btn btn-sm btn-primary">Reactivate</a>
                  <% } %>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } %>
  </main>
</body>
</html>
